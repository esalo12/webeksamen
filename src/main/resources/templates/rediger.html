<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <!-- ... -->
    <meta id="token" name="_csrf" th:content="${_csrf.token}"/>
    <meta id="headerName" name="_csrf_header" th:content="${_csrf.headerName}"/>
    <!-- ... -->
    <title>Bilde</title>
    <script src="exif.js"></script>
    <script>
        /*<![CDATA[*/
        function slettKommentar(id) {
            var token = document.getElementById("token").getAttribute("content");
            var headerName = document.getElementById("headerName").getAttribute("content");
            var bilde = document.getElementById("bilde").name;
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                    console.log(xmlHttp.responseText);
                }
            };
            xmlHttp.open("POST", "/kommentar/slett", true);
            xmlHttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlHttp.setRequestHeader(headerName, token);
            xmlHttp.send("id="+id+"&bilde="+bilde);
        }

        function lagre(){
            var token = document.getElementById("token").getAttribute("content");
            var headerName = document.getElementById("headerName").getAttribute("content");
            var bilde = document.getElementById("bilde").name;
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                    console.log(xmlHttp.responseText);
                }
            };
            xmlHttp.open("POST", "/kommentar/slett", true);
            xmlHttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlHttp.setRequestHeader(headerName, token);
            xmlHttp.send("id="+id+"&bilde="+bilde);
        }
        function fjernTag(id) {
            console.log(id);
            var rad = document.getElementById("rad");
            var fjerntag = document.getElementById(id);
            rad.removeChild(fjerntag);

        }
        function leggTilTag() {
            var nytag = document.getElementById("nytag").value;
            var rad = document.getElementById("rad");
            var nycelle = document.createElement("td");
            var tekst = document.createElement("text");
            nycelle.id=nytag;
            tekst.innerHTML=nytag;
            tekst.setAttribute("onclick", "fjernTag(this.parentNode.id)");
            nycelle.appendChild(tekst);
            rad.appendChild(nycelle);
            console.log(nytag);

        }

        function lagreEndring() {
            var token = document.getElementById("token").getAttribute("content");
            var headerName = document.getElementById("headerName").getAttribute("content");
            var tittel = document.getElementById("tittel").value;
            var id = document.getElementById("tittel").name;
            console.log(id);
            var rad = document.getElementById("rad");
            var liste = new Array();
            for ( var i= 0; i < rad.childElementCount; i++){
                var tag = rad.cells[i].id;
                liste.push(tag);
            }
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                    console.log(xmlHttp.responseText);
                }
            };
            xmlHttp.open("POST", "/rediger", true);
            xmlHttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlHttp.setRequestHeader(headerName, token);
            xmlHttp.send("id="+id+"&tittel="+tittel+"&tags="+liste);
        }
        /*]]>*/
    </script>
</head>
<body>
<h1>Redigering</h1>
<a href="/fotograf">Hjem</a>
<h2 th:text="'Bilde tittel: '+${bilde.tittel}" th:name="${bilde.tittel}"></h2>
<br />
<input type="text" th:name="${bilde.id}" id="tittel" th:value="${bilde.tittel}" />
<table id="tabell" >
    <tr id="rad" >
        <td th:each="tag : ${bilde.tags}" th:id="${tag}">
            <text th:text="${tag}" onclick="fjernTag(this.parentNode.id)" ></text>
        </td>
    </tr>
</table>
<br/>
<input id="nytag" type="text" /><button onclick="leggTilTag()">Legg til tag</button>
<br/>
<button onclick="lagreEndring()">Lagre endring</button>
<button >Angre</button>
<br/>

<img style="max-width: 1000px" th:src="@{/files/}+${bilde.filnavn}" id="bilde" th:name="${bilde.id}"/>

<div id="kommentarer" >
    <div th:each="k : ${bilde.kommentarer}" >
        <div th:id="${k.id}">
            <text>____________________________________</text>
            <p th:text="${k.dato}"></p>
            <p th:text="${k.navn}+': '"></p>
            <p th:text="${k.kommentar}"></p>
            <button th:name="${k.id}" onclick="slettKommentar(this.name)">Slett</button>
        </div>
    </div>
</div>


</body>
</html>